"use strict";(self.webpackChunkemail_campaign_dashboard=self.webpackChunkemail_campaign_dashboard||[]).push([[513],{513:(e,t,s)=>{s.r(t),s.d(t,{default:()=>i});const i=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.config=e||{accountName:"emaildash",containerName:"user-data"},this.dataCache=new Map,this.cacheTTL=3e5,this.initialized=!1}async initialize(){if(this.initialized)return!0;try{return await this.testConnection(),this.initialized=!0,!0}catch(e){return console.error("Failed to initialize Azure Blob Storage connection:",e),!1}}async testConnection(){try{const e=this.generateSasUrl("analysis/user_profiles_summary.json"),t=await fetch(e);if(!t.ok)throw new Error(`HTTP error: ${t.status}`);return!0}catch(e){throw console.error("Test connection failed:",e),e}}generateSasUrl(e){return`${`https://${this.config.accountName}.blob.core.windows.net/${this.config.containerName}`}/${e}?sv=2022-11-02&ss=bfqt&srt=sco&sp=rwdlacupiytfx&se=2027-06-02T03:35:14Z&st=2025-03-14T19:35:14Z&spr=https&sig=2Jk8LtrUnqf7QU5hOa8U3PsPbhN7RboKX%2Fvwrm2og8w%3D`}async loadJsonFile(e){const t=`json:${e}`,s=this.checkCache(t);if(s)return s;try{await this.ensureInitialized();const s=this.generateSasUrl(e),i=await fetch(s);if(!i.ok)throw new Error(`HTTP error: ${i.status}`);const n=await i.json();return this.setCache(t,n),n}catch(i){return console.error(`Error loading JSON file ${e}:`,i),null}}async getTopUsers(e){await this.ensureInitialized();try{var t,s,i,n,o,a;const r=await this.loadJsonFile("analysis/unified_user_profiles.json");if(!r||0===Object.keys(r).length)throw new Error("User profile data not available");let c=Object.entries(r).map((e=>{var t,s,i,n,o,a,r,c,l,p;let[u,g]=e;return{email:u,name:`${(null===(t=g.personal_info)||void 0===t?void 0:t.first_name)||""} ${(null===(s=g.personal_info)||void 0===s?void 0:s.last_name)||""}`.trim(),specialty:null===(i=g.personal_info)||void 0===i?void 0:i.specialty,profession:(null===(n=g.personal_info)||void 0===n?void 0:n.profession_type)||(null===(o=g.personal_info)||void 0===o?void 0:o.profession),engagementScore:(null===(a=g.engagement_metrics)||void 0===a?void 0:a.engagement_score)||0,openRate:null!==(r=g.engagement_metrics)&&void 0!==r&&r.open_rate?100*g.engagement_metrics.open_rate:0,clickRate:null!==(c=g.engagement_metrics)&&void 0!==c&&c.click_rate?100*g.engagement_metrics.click_rate:0,responseTime:null===(l=g.engagement_metrics)||void 0===l?void 0:l.avg_response_time,topics:(null===(p=g.content_preferences)||void 0===p?void 0:p.top_topics)||[]}}));e.specialties&&e.specialties.length>0&&(c=c.filter((t=>t.specialty&&e.specialties.some((e=>t.specialty.toLowerCase().includes(e.toLowerCase())))))),e.professions&&e.professions.length>0&&(c=c.filter((t=>t.profession&&e.professions.some((e=>t.profession.toLowerCase().includes(e.toLowerCase())))))),e.topics&&e.topics.length>0&&(c=c.filter((t=>t.topics&&t.topics.some((t=>e.topics.some((e=>t.topic&&t.topic.toLowerCase().includes(e.toLowerCase()))))))));let l="engagementScore";e.metrics&&e.metrics.length>0&&(e.metrics.includes("open_rate")?l="openRate":e.metrics.includes("click_rate")&&(l="clickRate")),c.sort(((e,t)=>t[l]-e[l]));const p=e.limit||20;return{users:c.slice(0,p),totalMatching:c.length,segment:(null===(t=e.specialties)||void 0===t?void 0:t[0])||(null===(s=e.professions)||void 0===s?void 0:s[0])||(null===(i=e.topics)||void 0===i?void 0:i[0]),segmentType:null!==(n=e.specialties)&&void 0!==n&&n.length?"specialty":null!==(o=e.professions)&&void 0!==o&&o.length?"profession":null!==(a=e.topics)&&void 0!==a&&a.length?"topic":null,sortedBy:l}}catch(r){throw console.error("Error getting top users:",r),r}}async getContentPerformance(e){await this.ensureInitialized();try{var t,s;const i=await this.loadJsonFile("analysis/topic_affinity.json");if(!i||!i.topic_summary)throw new Error("Topic data not available");let n=Object.entries(i.topic_summary).map((e=>{let[t,s]=e;return{topic:t,engagementScore:s.engagement_score||0,openRate:s.open_rate?100*s.open_rate:0,clickRate:s.click_rate?100*s.click_rate:0,totalSent:s.total_sent||0,shareRate:s.share_rate?100*s.share_rate:0}}));if(e.topics&&e.topics.length>0&&(n=n.filter((t=>e.topics.some((e=>t.topic.toLowerCase().includes(e.toLowerCase())))))),e.specialties&&e.specialties.length>0){const t=await this.loadJsonFile("analysis/audience_insights.json");if(t&&t.specialty_insights){const s=e.specialties.flatMap((e=>{const s=Object.entries(t.specialty_insights).find((t=>{let[s]=t;return s.toLowerCase().includes(e.toLowerCase())}));return s&&s[1].preferences&&s[1].preferences.topics?s[1].preferences.topics.map((e=>e.topic)):[]}));s.length>0&&(n=n.filter((e=>s.includes(e.topic))))}}let o="engagementScore";e.metrics&&e.metrics.length>0&&(e.metrics.includes("open_rate")?o="openRate":e.metrics.includes("click_rate")&&(o="clickRate")),n.sort(((e,t)=>t[o]-e[o]));const a=e.limit||10,r=n.slice(0,a);let c=[];return e.campaigns&&e.campaigns.length>0&&(c=e.campaigns),{content:r,totalMatching:n.length,segment:(null===(t=e.specialties)||void 0===t?void 0:t[0])||(null===(s=e.topics)||void 0===s?void 0:s[0]),contentTypes:c}}catch(i){throw console.error("Error getting content performance:",i),i}}async getTimingInsights(e){await this.ensureInitialized();try{var t,s;const i=await this.loadJsonFile("analysis/time_patterns.json");if(!i)throw new Error("Time patterns data not available");const n={avgTimeToOpen:null===(t=i.overall_metrics)||void 0===t?void 0:t.average_hours_to_open,medianTimeToOpen:null===(s=i.overall_metrics)||void 0===s?void 0:s.median_hours_to_open,peakHours:[]};if(i.hourly_distribution&&(n.peakHours=Object.entries(i.hourly_distribution).map((e=>{let[t,s]=e;return{hour:parseInt(t),count:s}})).sort(((e,t)=>t.count-e.count)).slice(0,5)),i.day_of_week_distribution&&(n.dayDistribution=Object.entries(i.day_of_week_distribution).map((e=>{let[t,s]=e;return{day:t,count:s}}))),e.specialties&&e.specialties.length>0){const t=e.specialties[0];if(i.specialty_metrics){const e=Object.keys(i.specialty_metrics).find((e=>e.toLowerCase().includes(t.toLowerCase())));e&&(n.segment=t,n.specialtyMetrics=i.specialty_metrics[e])}}if(e.professions&&e.professions.length>0){const t=e.professions[0];if(i.profession_metrics){const e=Object.keys(i.profession_metrics).find((e=>e.toLowerCase().includes(t.toLowerCase())));e&&(n.segment=t,n.professionMetrics=i.profession_metrics[e])}}return n}catch(i){throw console.error("Error getting timing insights:",i),i}}async getAudienceOverview(e){await this.ensureInitialized();try{var t,s,i,n,o;const[a,r,c,l]=await Promise.all([this.loadJsonFile("analysis/user_profiles_summary.json"),this.loadJsonFile("analysis/engagement_metrics.json"),this.loadJsonFile("analysis/audience_insights.json"),this.loadJsonFile("analysis/topic_affinity.json")]);if(!a&&!r&&!c)throw new Error("Audience data not available");const p={totalUsers:(null===a||void 0===a?void 0:a.total_profiles)||0,avgOpenRate:null!==r&&void 0!==r&&null!==(t=r.overall_metrics)&&void 0!==t&&t.avg_open_rate?100*r.overall_metrics.avg_open_rate:0,avgClickRate:null!==r&&void 0!==r&&null!==(s=r.overall_metrics)&&void 0!==s&&s.avg_click_rate?100*r.overall_metrics.avg_click_rate:0};let u=[];null!==a&&void 0!==a&&a.specialties&&(u=Object.entries(a.specialties).map((e=>{let[t,s]=e;return{specialty:t,userCount:s,avgOpenRate:100*this.getSpecialtyMetric(r,t,"open_rate"),avgClickRate:100*this.getSpecialtyMetric(r,t,"click_rate")}})).sort(((e,t)=>t.userCount-e.userCount)).slice(0,5));let g=[];null!==l&&void 0!==l&&l.topic_summary&&(g=Object.entries(l.topic_summary).map((e=>{let[t,s]=e;return{topic:t,engagementScore:s.engagement_score||0,openRate:s.open_rate?100*s.open_rate:0}})).sort(((e,t)=>t.engagementScore-e.engagementScore)).slice(0,5));let d=[];null!==c&&void 0!==c&&null!==(i=c.content_patterns)&&void 0!==i&&null!==(n=i.timing_patterns)&&void 0!==n&&n.best_send_hours&&(d=Object.entries(c.content_patterns.timing_patterns.best_send_hours).map((e=>{let[t,s]=e;return{hour:parseInt(t),count:s}})).sort(((e,t)=>t.count-e.count)));let m={};if(null!==a&&void 0!==a&&a.engagement_tiers&&(m={highEngagement:a.engagement_tiers.highly_engaged||0,moderateEngagement:a.engagement_tiers.moderately_engaged||0,lowEngagement:a.engagement_tiers.low_engagement||0}),e.specialties&&e.specialties.length>0){const t=e.specialties[0];if(null!==r&&void 0!==r&&r.specialty_metrics){const e=Object.entries(r.specialty_metrics).find((e=>{let[s]=e;return s.toLowerCase().includes(t.toLowerCase())}));e&&(p.avgEngagement=e[1].avg_engagement||0,p.userCount=e[1].user_count||0)}if(null!==c&&void 0!==c&&c.specialty_insights){const e=Object.entries(c.specialty_insights).find((e=>{let[s]=e;return s.toLowerCase().includes(t.toLowerCase())}));e&&e[1].preferences&&e[1].preferences.topics&&(g=e[1].preferences.topics.map((e=>({topic:e.topic,engagementScore:e.count/10}))))}}const h=[];return a&&h.push("user_profiles"),r&&h.push("engagement_metrics"),c&&h.push("audience_insights"),l&&h.push("topic_affinity"),{overallMetrics:p,topSpecialties:u,contentPreferences:{bestTopics:g,timing:{bestHours:d}},segmentSummary:m,segment:null===(o=e.specialties)||void 0===o?void 0:o[0],_dataSources:h}}catch(a){throw console.error("Error getting audience overview:",a),a}}async getUserProfile(e){await this.ensureInitialized();try{if(!e.email)throw new Error("Email required for user profile lookup");const t=await this.loadJsonFile("analysis/unified_user_profiles.json");if(!t)throw new Error("User profile data not available");const s=e.email.toLowerCase();let i=null;if(t[s])i=t[s];else{const e=Object.keys(t).find((e=>e.toLowerCase().includes(s)||s.includes(e.toLowerCase())));e&&(i=t[e])}if(!i)throw new Error(`No profile found for ${e.email}`);return{email:e.email,personalInfo:i.personal_info||{},engagementMetrics:i.engagement_metrics||{},contentPreferences:i.content_preferences||{},journeyPatterns:i.journey_patterns||{}}}catch(t){throw console.error("Error getting user profile:",t),t}}async getSpecialtyEngagement(e){await this.ensureInitialized();try{if(!e.specialties||0===e.specialties.length)throw new Error("Specialty required for engagement lookup");const t=e.specialties[0],[s,i,n]=await Promise.all([this.loadJsonFile("analysis/engagement_metrics.json"),this.loadJsonFile("analysis/audience_insights.json"),this.loadJsonFile("analysis/topic_affinity.json")]);if(!s&&!i)throw new Error("Specialty engagement data not available");let o=0,a={};if(null!==s&&void 0!==s&&s.specialty_metrics){const e=Object.keys(s.specialty_metrics).find((e=>e.toLowerCase().includes(t.toLowerCase())));if(e){const t=s.specialty_metrics[e];a={openRate:t.avg_engagement||0,clickRate:t.avg_engagement/2||0,responseTime:3*t.avg_engagement||0},o=t.user_count||0}}let r=[];if(null!==i&&void 0!==i&&i.specialty_insights){const e=Object.keys(i.specialty_insights).find((e=>e.toLowerCase().includes(t.toLowerCase())));if(e&&i.specialty_insights[e].preferences){const t=i.specialty_insights[e].preferences;t.topics&&(r=t.topics.map((e=>({topic:e.topic,score:e.count/10,openRate:30*Math.random()+20}))))}}let c=[];if(null!==n&&void 0!==n&&n.user_affinities){const e=new Map;Object.values(n.user_affinities).forEach((t=>{Object.entries(t).forEach((t=>{let[s,i]=t;e.has(s)||e.set(s,{score:0,count:0}),e.get(s).score+=i.engagement_score||0,e.get(s).count+=1}))})),c=Array.from(e.entries()).map((e=>{let[t,s]=e;return{topic:t,score:s.count>0?s.score/s.count:0}})).sort(((e,t)=>t.score-e.score)).slice(0,5)}const l=this.calculateStatisticalValidity(o);return{specialty:t,userCount:o,engagementMetrics:a,preferredTopics:r,bestContent:c,statisticalValidity:l}}catch(t){throw console.error("Error getting specialty engagement:",t),t}}async getSpecialtyComparison(e){await this.ensureInitialized();try{if(!e.specialties||e.specialties.length<1)throw new Error("At least one specialty required for comparison");const t=e.specialties;1===t.length&&t.push("Dermatology");const[s,i,n]=await Promise.all([this.loadJsonFile("analysis/engagement_metrics.json"),this.loadJsonFile("analysis/audience_insights.json"),this.loadJsonFile("analysis/user_profiles_summary.json")]);if(!s&&!i&&!n)throw new Error("Specialty comparison data not available");const o=[];for(const e of t){const t={specialty:e,userCount:0,engagementMetrics:{openRate:0,clickRate:0,responseTime:0},topTopics:[],devicePreference:"unknown"};if(null!==n&&void 0!==n&&n.specialties){const s=Object.keys(n.specialties).find((t=>t.toLowerCase().includes(e.toLowerCase())));s&&(t.userCount=n.specialties[s])}if(null!==s&&void 0!==s&&s.specialty_metrics){const i=Object.keys(s.specialty_metrics).find((t=>t.toLowerCase().includes(e.toLowerCase())));if(i){const e=s.specialty_metrics[i];t.engagementMetrics={openRate:e.avg_engagement||0,clickRate:e.avg_engagement/2||0,responseTime:3*e.avg_engagement||0}}}if(null!==i&&void 0!==i&&i.specialty_insights){const s=Object.keys(i.specialty_insights).find((t=>t.toLowerCase().includes(e.toLowerCase())));if(s&&i.specialty_insights[s].preferences){const e=i.specialty_insights[s].preferences;if(e.topics&&(t.topTopics=e.topics.map((e=>({topic:e.topic,score:e.count/10})))),e.devices){const s=Object.entries(e.devices);if(s.length>0){const[e]=s.sort(((e,t)=>t[1]-e[1]));e&&(t.devicePreference=e[0])}}}}o.push(t)}return{specialties:o}}catch(t){throw console.error("Error getting specialty comparison:",t),t}}async getUserCount(e){await this.ensureInitialized();try{const t=await this.loadJsonFile("analysis/user_profiles_summary.json");if(!t)throw new Error("User profile data not available");const s=t.total_profiles||0;let i=null,n=null;if(e.specialties&&e.specialties.length>0&&(n=e.specialties[0],t.specialties)){const e=Object.keys(t.specialties).find((e=>e.toLowerCase().includes(n.toLowerCase())));e&&(i=t.specialties[e])}let o=null,a=null;if(e.professions&&e.professions.length>0&&(a=e.professions[0],t.profession_breakdown)){const e=Object.keys(t.profession_breakdown).find((e=>e.toLowerCase().includes(a.toLowerCase())));e&&(o=t.profession_breakdown[e])}let r="high";return s<1e3&&(r="medium"),s<100&&(r="low"),{totalUsers:s,specialtyUsers:i,specialty:n,professionUsers:o,profession:a,confidence:r}}catch(t){throw console.error("Error getting user count:",t),t}}getSpecialtyMetric(e,t,s){if(!e||!e.specialty_metrics)return 0;const i=Object.keys(e.specialty_metrics).find((e=>e.toLowerCase().includes(t.toLowerCase())));if(!i)return 0;const n=e.specialty_metrics[i];return"open_rate"===s?n.avg_engagement||0:"click_rate"===s&&n.avg_engagement/2||0}calculateStatisticalValidity(e){let t="low";e>=100&&(t="medium"),e>=385&&(t="high");return{sample_size:e,sample_size_adequate:e>=30,confidence_level:t,margin_of_error:e>0?1/Math.sqrt(e):null}}async ensureInitialized(){return!!this.initialized||await this.initialize()}checkCache(e){if(!this.dataCache.has(e))return null;const{data:t,timestamp:s}=this.dataCache.get(e);return Date.now()-s>this.cacheTTL?(this.dataCache.delete(e),null):t}setCache(e,t){if(this.dataCache.set(e,{data:t,timestamp:Date.now()}),this.dataCache.size>50){Array.from(this.dataCache.keys()).slice(0,10).forEach((e=>this.dataCache.delete(e)))}}}}}]);
//# sourceMappingURL=513.b52fbb93.chunk.js.map